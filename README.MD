# LaughStorage Staking Tool API

ä¸€ä¸ªåŸºäº GoFrame æ¡†æ¶å¼€å‘çš„åŒºå—é“¾è´¨æŠ¼å·¥å…· API æœåŠ¡ï¼Œæ”¯æŒ Filecoin ç½‘ç»œä¸Šçš„è´¨æŠ¼ç®¡ç†å’Œææ¡ˆå®¡æ ¸åŠŸèƒ½ã€‚

## ğŸ“‹ ç›®å½•

- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
- [API æ–‡æ¡£](#api-æ–‡æ¡£)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸ› ï¸ ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶

- **Go**: 1.23.7 æˆ–æ›´é«˜ç‰ˆæœ¬
- **MySQL**: 8.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Redis**: 6.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Git**: ç”¨äºä»£ç ç‰ˆæœ¬æ§åˆ¶

### Go ç¯å¢ƒå®‰è£…

#### Linux/macOS

```bash
# ä¸‹è½½å¹¶å®‰è£… Go
wget https://golang.org/dl/go1.23.7.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.23.7.linux-amd64.tar.gz

# é…ç½®ç¯å¢ƒå˜é‡
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
echo 'export GOPATH=$HOME/go' >> ~/.bashrc
echo 'export GOROOT=/usr/local/go' >> ~/.bashrc
source ~/.bashrc

# éªŒè¯å®‰è£…
go version
```

#### Windows

1. ä» [Go å®˜ç½‘](https://golang.org/dl/) ä¸‹è½½ Windows å®‰è£…åŒ…
2. è¿è¡Œå®‰è£…ç¨‹åºå¹¶æŒ‰ç…§æç¤ºå®Œæˆå®‰è£…
3. é‡å¯å‘½ä»¤è¡Œå·¥å…·å¹¶éªŒè¯ï¼š`go version`

### GoFrame CLI å·¥å…·

æœ¬é¡¹ç›®ä½¿ç”¨ GoFrame æ¡†æ¶è¿›è¡Œå¼€å‘ï¼Œéœ€è¦å®‰è£… GoFrame CLI å·¥å…·ï¼š

```bash
# å®‰è£… GoFrame CLI
go install github.com/gogf/gf/v2/cmd/gf/v2@latest

# éªŒè¯å®‰è£…
gf version
```

æ›´å¤šä¿¡æ¯è¯·è®¿é—® [GoFrame å®˜ç½‘](https://goframe.org/)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <your-repository-url>
cd api
```

### 2. å®‰è£…ä¾èµ–

```bash
go mod tidy
```

### 3. é…ç½®æ•°æ®åº“

1. åˆ›å»º MySQL æ•°æ®åº“
2. å¯¼å…¥æ•°æ®åº“ç»“æ„ï¼š
   ```bash
   mysql -u your_username -p your_database < script.sql
   ```

### 4. é…ç½®ç¯å¢ƒ

å¤åˆ¶å¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š

```bash
cp config.toml.example config.toml
# ç¼–è¾‘ config.toml æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“ã€Redis ç­‰è¿æ¥ä¿¡æ¯
```

### 5. è¿è¡Œé¡¹ç›®

```bash
# å¼€å‘æ¨¡å¼è¿è¡Œ
go run main.go

# æˆ–è€…ä½¿ç”¨ Makefile
make build
./laughstorage_staking_tool
```

æœåŠ¡å°†åœ¨ `http://127.0.0.1:9002` å¯åŠ¨

## âš™ï¸ é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ç»“æ„

é¡¹ç›®ä½¿ç”¨ `config.toml` ä½œä¸ºä¸»é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ä¸»è¦é…ç½®é¡¹ï¼š

#### æœåŠ¡å™¨é…ç½®

```toml
[server]
address = "127.0.0.1:9002"  # æœåŠ¡ç›‘å¬åœ°å€
openapiPath = ""           # OpenAPI æ–‡æ¡£è·¯å¾„
swaggerPath = ""           # Swagger æ–‡æ¡£è·¯å¾„
appDebug = true           # è°ƒè¯•æ¨¡å¼
```

#### æ•°æ®åº“é…ç½®

```toml
[database.default]
type = "mysql"
host = "your_mysql_host"
port = "3306"
user = "your_username"
pass = "your_password"
name = "your_database"
timezone = "UTC"
parseTime = true
debug = true
```

#### Redis é…ç½®

```toml
[redis.default]
address = "127.0.0.1:6379"
db = 4
pass = "your_redis_password"
```

#### JWT é…ç½®

```toml
[jwt]
exp = 72000                                    # Token æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰
pre = "laughstorage_staking_tool_"            # Redis ä¸­ Token å‰ç¼€
issuer = "laughstorage_staking_tool_"         # Token å‘è¡Œè€…
key = "your_jwt_secret_key"                   # JWT å¯†é’¥
encryptKey = "your_encryption_key"            # åŠ å¯†å¯†é’¥
```

#### SIWE (Sign-In with Ethereum) é…ç½®

```toml
[siwe]
domain = "localhost:9000"  # Web3 ç™»å½•éªŒè¯åŸŸåï¼Œå¿…é¡»ä¸å‰ç«¯ä¸€è‡´
```

#### é˜¿é‡Œäº‘é…ç½® (KYC è®¤è¯)

```toml
[ali]
accessKeyId = "your_aliyun_access_key_id"
accessKeySecret = "your_aliyun_access_key_secret"
ossBucketName = "your_oss_bucket_name"
ossUrl = "your_oss_url"
region = "cn-hongkong"
```

#### åº”ç”¨é…ç½®

```toml
[app]
administrator = "0x..."                    # ç®¡ç†å‘˜é’±åŒ…åœ°å€ï¼ˆæ‹¥æœ‰å®¡æ ¸ææ¡ˆæƒé™ï¼Œå¤šä¸ªç”¨è‹±æ–‡é€—å·åˆ†éš”ï¼‰
rpc = "https://filecoin-calibration.chainup.net/rpc/v1"  # Filecoin RPC åœ°å€
stakingContract = "0x..."                  # è´¨æŠ¼åˆçº¦åœ°å€
```

#### åˆ†é…å™¨é…ç½®

```allocator
[allocator]
contract = ""   # åˆ†é…å™¨åˆçº¦åœ°å€
account  = ""   # å…¬è¯äººåœ°å€
accountPrivateKey = ""  # å…¬è¯äººç§é’¥
```

### é‡è¦é…ç½®è¯´æ˜

1. **administrator**: è¿™æ˜¯æœ€é‡è¦çš„é…ç½®é¡¹ï¼ŒæŒ‡å®šæ‹¥æœ‰å®¡æ ¸ææ¡ˆæƒé™çš„é’±åŒ…åœ°å€
2. **domain**: SIWE é…ç½®ä¸­çš„åŸŸåå¿…é¡»ä¸å‰ç«¯åº”ç”¨çš„åŸŸåå®Œå…¨ä¸€è‡´
3. **æ•°æ®åº“**: ç¡®ä¿æ•°æ®åº“è¿æ¥ä¿¡æ¯æ­£ç¡®ï¼Œå¹¶å·²å¯¼å…¥ `script.sql` æ–‡ä»¶
4. **Redis**: ç”¨äºç¼“å­˜å’Œä¼šè¯ç®¡ç†ï¼Œç¡®ä¿è¿æ¥æ­£å¸¸

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
api/
â”œâ”€â”€ api/                    # API è·¯ç”±å®šä¹‰
â”œâ”€â”€ internal/              # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ cmd/              # å‘½ä»¤è¡Œå…¥å£
â”‚   â”œâ”€â”€ controller/       # æ§åˆ¶å™¨å±‚
â”‚   â”œâ”€â”€ dao/             # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ logic/           # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ model/           # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ service/         # æœåŠ¡å±‚
â”œâ”€â”€ resource/            # é™æ€èµ„æº
â”œâ”€â”€ manifest/           # éƒ¨ç½²é…ç½®
â””â”€â”€ main.go            # ç¨‹åºå…¥å£
```

### å¸¸ç”¨å¼€å‘å‘½ä»¤

```bash
# ç”Ÿæˆæ§åˆ¶å™¨ä»£ç 
gf ge  ctrl

# ç”Ÿæˆæ•°æ®è®¿é—®å±‚ä»£ç 
gf gen dao

# æ„å»ºé¡¹ç›®
gf build

```

### ä»£ç ç”Ÿæˆ

é¡¹ç›®ä½¿ç”¨ GoFrame çš„ä»£ç ç”ŸæˆåŠŸèƒ½ï¼š

```bash
# æ ¹æ® API å®šä¹‰ç”Ÿæˆæ§åˆ¶å™¨
gf gen ctrl

# æ ¹æ®æ•°æ®åº“è¡¨ç”Ÿæˆ DAO/DO/Entity
gf gen dao

```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. ä¿®æ”¹ `config.toml` ä¸­çš„ç”Ÿäº§ç¯å¢ƒé…ç½®
2. ç¡®ä¿æ•°æ®åº“å’Œ Redis è¿æ¥ç¨³å®š
3. é…ç½®åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰
4. è®¾ç½® SSL è¯ä¹¦
5. é…ç½®æ—¥å¿—è½®è½¬

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: å¯åŠ¨æ—¶æç¤ºæ•°æ®åº“è¿æ¥å¤±è´¥

A: æ£€æŸ¥ `config.toml` ä¸­çš„æ•°æ®åº“é…ç½®ï¼Œç¡®ä¿ï¼š

- æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œ
- è¿æ¥ä¿¡æ¯æ­£ç¡®
- æ•°æ®åº“å·²åˆ›å»ºå¹¶å¯¼å…¥äº† `script.sql`

### Q: JWT Token éªŒè¯å¤±è´¥

A: æ£€æŸ¥ JWT é…ç½®ï¼š

- ç¡®ä¿ `key` å’Œ `encryptKey` é…ç½®æ­£ç¡®
- æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸ
- éªŒè¯ Redis è¿æ¥æ­£å¸¸

### Q: KYC è®¤è¯å¤±è´¥

A: æ£€æŸ¥é˜¿é‡Œäº‘é…ç½®ï¼š

- ç¡®ä¿ AccessKey æœ‰æ•ˆ
- æ£€æŸ¥ OSS Bucket æƒé™
- éªŒè¯åŒºåŸŸé…ç½®æ­£ç¡®

### Q: Web3 ç™»å½•å¤±è´¥

A: æ£€æŸ¥ SIWE é…ç½®ï¼š

- ç¡®ä¿ `domain` ä¸å‰ç«¯åŸŸåä¸€è‡´
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- éªŒè¯é’±åŒ…è¿æ¥æ­£å¸¸

## ğŸ“ æ—¥å¿—

æ—¥å¿—æ–‡ä»¶ä½äº `log/` ç›®å½•ä¸‹ï¼ŒæŒ‰æ—¥æœŸè‡ªåŠ¨åˆ†å‰²ã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹ `config.toml` ä¸­çš„æ—¥å¿—é…ç½®æ¥è°ƒæ•´æ—¥å¿—çº§åˆ«å’Œè¾“å‡ºæ ¼å¼ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜) éƒ¨åˆ†
2. æ£€æŸ¥é¡¹ç›® [Issues](https://github.com/your-repo/issues)
3. åˆ›å»ºæ–°çš„ Issue æè¿°æ‚¨çš„é—®é¢˜

---

**æ³¨æ„**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²å‰ï¼Œè¯·ç¡®ä¿ï¼š

- æ‰€æœ‰æ•æ„Ÿä¿¡æ¯å·²æ­£ç¡®é…ç½®
- æ•°æ®åº“å·²å¤‡ä»½
- ç›‘æ§å’Œæ—¥å¿—ç³»ç»Ÿå·²é…ç½®
- å®‰å…¨æªæ–½å·²å®æ–½
